# Variables containing version strings extracted from the canonical sources:
# tensorflow/core/public/version.h and tools/pip_package/setup.py.
#
# These variables aren't available by default. Scripts must source this file
# explicitly, *after* checking if update_version.py needs to be run for a
# nightly job. update_version.py affects TFCI_VER_SUFFIX, TFCI_VER_PYTHON, and
# TFCI_VER_FULL.

# Note: in awk, the command '/search/ {commands}' applies the commands to any line that
# matches the /search/ regular expression. "print $N" prints the Nth "field",
# where fields are strings separated by whitespace.
TFCI_VER_MAJOR=$(awk '/#define TF_MAJOR_VERSION/ {print $3}' tensorflow/core/public/version.h)
TFCI_VER_MINOR=$(awk '/#define TF_MINOR_VERSION/ {print $3}' tensorflow/core/public/version.h)
TFCI_VER_PATCH=$(awk '/#define TF_PATCH_VERSION/ {print $3}' tensorflow/core/public/version.h)

# Note: in awk, "print $N" prints the Nth "field", where fields are strings separated
# by whitespace. The flag "-F<x>" changes the behavior such that fields are now strings
# separated by the character <x>. Therefore, -F\' (escaped single quote) means that field
# $2 in <Tensor'flow'> is <flow>. This is useful for reading string literals like below.
TFCI_VER_SUFFIX=$(awk -F\" '/#define TF_VERSION_SUFFIX/ {print $2}' tensorflow/core/public/version.h)
TFCI_VER_PYTHON=$(awk -F\' '/_VERSION =/ {print $2}' tensorflow/tools/pip_package/setup.py)

# Derived helper variables.
TFCI_VER_SHORT="${TFCI_VER_MAJOR}.${TFCI_VER_MINOR}"
TFCI_VER_FULL="${TFCI_VER_MAJOR}.${TFCI_VER_MINOR}.${TFCI_VER_PATCH}${TFCI_VER_SUFFIX}"
